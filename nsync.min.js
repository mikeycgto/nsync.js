(function(){function c(a){return!!a&&a.constructor===Object}function d(a,b,e){for(var f in b)b[f]&&typeof b[f]=="object"?((!c(a[f])||a[f].constructor!==b[f].constructor)&&delete a[f],d(a[f]||(a[f]=c(b[f])?{}:[]),b[f])):a[f]=b[f];return a}var a=this.nsync=function(a){this.data=d({},a)},b=Array.prototype.indexOf||function(a){for(var b=0;b<this.length;b++)if(this[b]===a)return b;return-1};this.PubSub={publish:function(a){var b=this.handlers||(this.handlers={}),c=b[a];if(!c)return;var d=Array.prototype.slice.call(arguments,1);for(var e=0;e<c.length;e++)c[e].apply(this,d);return this},subscribe:function(a,c){var d=this.handlers||(this.handlers={});if(!c)for(var e in a)this.subscribe(e,a[e]);else{var f=d[a]||(d[a]=[]);b.call(f,c)<0&&f.push(c)}return this},unsubscribe:function(a,b){var c=this.handlers||(this.handlers={}),d=c[a];if(!d)return;for(var e=0;e<d.length;)b==d[e]?d.splice(e,1):e++;return this}},d(a.prototype,this.PubSub),d(a.prototype,{changed:function(a){if(this.changes==null)return!1;var b=new Function("try{with(this){return "+a+"!==undefined; }}catch(e){return !1;}");return b.call(this.changes)},update:function(a,b){this.changes=d({},a),this.previous=d({},this.data),d(this.data,a),b||this.publish("update")}})})();