(function(){function b(a){return!!a&&a.constructor===Object}function c(a,d){var e=[];for(var f in a){var g=d?d+"."+f:f;e.push(g),b(a[f])&&(e=e.concat(c(a[f],g)))}return e}function d(a,c){for(var e in c)c[e]&&typeof c[e]=="object"?((!b(a[e])||a[e].constructor!==c[e].constructor)&&delete a[e],d(a[e]||(a[e]=b(c[e])?{}:[]),c[e])):a[e]=c[e];return a}var a;a=this.nsync=function(a){this.data=d({},a)};var e=Array.prototype.indexOf||function(a){for(var b=0;b<this.length;b++)if(this[b]===a)return b;return-1};d(a.prototype,{publish:function(a){if(!this._paths)return;a=a||".";var b=this._paths[a];if(b)for(var c=0;c<b.length;c++)b[c].call(this,a)},subscribe:function(a,b){var c=this._paths||(this._paths={}),d=b?a.split(/\s+/).concat(["."]):["."];for(var f=0;f<d.length;f++){var g=c[d[f]]||(c[d[f]]=[]);e.call(g,b)<0&&g.push(b||a)}},unsubscribe:function(a,b){if(!this._paths)return;if(!b)return this.unsubscribe(".",a);var c=this._paths[a];for(var d=0;d<c.length;)b===c[d]?c.splice(d,1):d++},update:function(a,b){this.previous=d({},this.data),this.changed=c(a),d(this.data,a);if(b)return;for(var e=0;e<this.changed.length;e++)this.publish(this.changed[e])},refresh:function(){this.publish()}})})()