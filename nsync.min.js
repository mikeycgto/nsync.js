(function(){function b(a){return!!a&&a.constructor===Object}function c(a,d,e){for(var f in d)d[f]&&typeof d[f]=="object"?((!b(a[f])||a[f].constructor!==d[f].constructor)&&delete a[f],c(a[f]||(a[f]=b(d[f])?{}:[]),d[f])):a[f]=d[f];return a}this.nsync=function(a){this.data=c({},a)};var a=Array.prototype.indexOf||function(a){for(var b=0;b<this.length;b++)if(this[b]===a)return b;return-1};this.PubSub=nsync.prototype={publish:function(a,b){var c=this.handlers||(this.handlers={}),d=c[a];if(!d)return;var e=Array.prototype.slice.call(arguments,2);for(var f=0;f<d.length;f++)d[f].apply(b||this,e);return this},subscribe:function(b,c){var d=this.handlers||(this.handlers={});if(!c)for(var e in b)this.on(e,b[e]);else{var f=d[b]||(d[b]=[]);a.call(f,c)<0&&f.push(c)}return this},unsubscribe:function(a,b){var c=this.handlers||(this.handlers={}),d=c[a];if(!d)return;for(var e=0;e<d.length;)b==d[e]?d.splice(e,1):e++;return this}},c(nsync.prototype,{changed:function(a){var b=new Function("try{with(this){return "+a+"; }}catch(e){return !1;}");return!!b.call(this.changes)},update:function(a){this.changes=c({},a),this.previous=c({},this.data),c(this.data,a),this.publish("update")}})})();