(function(){function c(a){return!!a&&a.constructor===Object}function d(a,b,e){for(var f in a)c(b[f])?d(a[f],b[f],e[f]={}):e[f]=!!b[f]}function e(a,b,d){for(var f in b)b[f]&&typeof b[f]=="object"?((!c(a[f])||a[f].constructor!==b[f].constructor)&&delete a[f],e(a[f]||(a[f]=c(b[f])?{}:[]),b[f])):a[f]=b[f];return a}var a;a=this.nsync=function(a){this.data=e({},a)};var b=Array.prototype.indexOf||function(a){for(var b=0;b<this.length;b++)if(this[b]===a)return b;return-1};e(a.prototype,{publish:function(a){var b=this._paths;if(!b)return;var c=a||this.data;for(var d in b){var e=new Function("try{with(this){return "+d+"; }}catch(e){return !1;}");if(e.call(c)){var f=b[d];for(var g=0;g<f.length;g++)f[g].call(this)}}},subscribe:function(a,c){var d=this._paths||(this._paths={}),e=d[a]||(d[a]=[]);b.call(e,c)<0&&e.push(c)},unsubscribe:function(a,b){var c=this._paths[a];if(!c)return;for(var d=0;d<c.length;)b===c[d]?c.splice(d,1):d++},update:function(a,b){this.previous=e({},this.data),e(this.data,a);var c=this.changes={};d(this.data,a,c),b||this.publish(c)}})})()